function Edit(){return this instanceof Edit?void this.init():new Edit}Edit.prototype={crtFolderId:0,crtFileId:0,crtFileObj:{},moveToFolderId:0,tobeMovedNoteId:0,isMainEventInited:!1,init:function(){$.hkLoading(),this.initGloDOM(),this.setContentHeight(),this.initBoxesLocation(),this.initCrtNotes()},setContentHeight:function(){if($(window).width()>768){var t=$("header").height(),e=$("footer").height(),i=$(window).height(),n=i-t-e;$(".aside").add($main).add($middle).css("height",n+"px")}},initBoxesLocation:function(){var t=$(window).width(),e=$(window).height();this.notyBoxLocation(t,e),this.moveBoxLocation(t,e)},notyBoxLocation:function(t,e){var i=$notyBox.width(),n=$notyBox.height();$notyBox.css({top:(e-n)/2-100+"px",left:(t-i)/2+"px"})},moveBoxLocation:function(t,e){if(t>480){var i=$moveBox.width(),n=$moveBox.height();$moveBox.css({top:(e-n)/2+"px",left:(t-i)/2+"px"});var o=$moveBox.find(".content"),d=.68*n;o.height(d)}else{$moveBox.width(.92*t),$moveBox.height(.8*e);var i=$moveBox.width(),n=$moveBox.height();$(".cont-display").height(.5*n),$moveBox.css({top:(e-n)/2+"px",left:(t-i)/2+"px"})}},initCrtNotes:function(){var t=$.getUrlPara("fileId"),e=$.getUrlPara("folderId"),i=this;t?(this.crtFileId=t,$.hkAjax("get","/notes/getfolderbyfileid",{fileId:t},function(t){console.log("res folder:",t),i.crtFolderId=t.noteId,i.fetchnotes(!0)})):e?(this.crtFolderId=e,this.fetchnotes(!0)):this.fetchnotes(!0)},initGloDOM:function(){$asideNavList=$(".aside .nav-list"),$middle=$(".middle"),$middleList=$middle.find(".file-list"),$main=$(".main"),$title=$main.find(".title"),$fullEditBtn=$main.find(".icon-column"),$save=$main.find(".icon-save"),$displayBtn=$main.find(".icon-display"),$textarea=$("textarea"),$saveTip=$(".saved-tip"),$notyBox=$(".noty-box"),$notyMask=$(".noty-mask"),$moveBox=$(".move-box"),$moveMask=$(".move-mask"),$moveConfirm=$moveBox.find(".move-btns .confirm")},initBodyEvent:function(){$displayBtn.click(function(){$.hkPopupTip("please select a file to display!")}),$fullEditBtn.click(function(){$.hkPopupTip("please select a file to edit in full screen!")}),$(".stack").click(function(){return!1}),document.body.addEventListener("click",function(){$(".dropdown-menu").hide()},!0)},renderAside:function(t){console.log("renderAside:",t);var e=template("tpl-folder-list",t);$(".aside .nav-list").html(e),$(".new").attr("disabled",!1),$(".newfolder").attr("disabled",!1);var i=template("tpl-movebox-list",t);$(".move-box .cont-display .move-list").html(i),this.crtFolderId?$asideNavList.find(".a-wrapper[data-noteid='"+this.crtFolderId+"']").trigger("click"):$asideNavList.find(".a-wrapper").eq(0).trigger("click")},renderMiddle:function(t){var e=template("tpl-file-list",t);$(".middle .file-list").html(e),$(".newfile").attr("disabled",!1),this.crtFileId&&this.crtFileId==$.getUrlPara("fileId")?$middleList.find(".a-wrapper[data-noteid='"+this.crtFileId+"']").trigger("click"):$middleList.find(".a-wrapper").eq(0).trigger("click")},renderMain:function(){$title.val(this.crtFileObj.title),$textarea.val(this.crtFileObj.content),this.isMainEventInited||(this.initMainEvent(),this.isMainEventInited=!0)},initMoveBoxEvent:function(){var t=this;$moveBox.on("click",".icon-form-close,.cancel",function(){$moveBox.hide(),$moveMask.hide()}).on("click",".list-item .item",function(){$(this).parents(".move-list").find(".item").removeClass("active"),$(this).addClass("active"),t.moveToFolderId=$(this).attr("data-noteid"),$moveConfirm.attr("disabled",!1),$moveConfirm.removeClass("disabled")}),$moveConfirm.click(function(){t.moveNote()})},moveNote:function(){var t=this.moveToFolderId,e=this.tobeMovedNoteId;if(t==e)return void $.hkPopupTip("don't move the folder into itself!");var i=this;$.hkAjax("post","/notes/movenote",{parentFolderId:t,noteId:e},function(t){console.log("move res:",t),i.fetchnotes(),$moveConfirm.attr("disabled",!0),$moveConfirm.addClass("disabled"),$moveBox.hide(),$moveMask.hide()},"text")},initMainEvent:function(){var t=this;$title.donetyping(function(){t.crtFileObj.title=$(this).val(),t.updateFile(t.crtFileObj)},500),$textarea.donetyping(function(){t.crtFileObj.content=$(this).val(),t.updateFile(t.crtFileObj)},500),$save.click(function(){t.crtFileObj.title=$title.val(),t.crtFileObj.content=$textarea.val(),t.updateFile(t.crtFileObj)}),$fullEditBtn.off("click"),$fullEditBtn.click(function(){window.location.href="/notes/full-edit.html?fileId="+t.crtFileId}),$displayBtn.off("click"),$displayBtn.click(function(){window.location.href="/notes/notedetail.html?fileId="+t.crtFileId})},initSwitchListItemEvent:function(){var t=this;$asideNavList.on("click",".a-wrapper",function(){$(this).parents(".nav-list").find(".a-wrapper").removeClass("active"),$(this).addClass("active");var e=$(this).attr("data-noteid");t.crtFolderId=e,t.fetchFileList(e)}),$middleList.on("click",".a-wrapper",function(){$(this).parents(".file-list").find(".a-wrapper").removeClass("active"),$(this).addClass("active"),t.crtFileId=$(this).attr("data-noteid"),t.fetchFile(t.crtFileId)})},initDropdownEvent:function(){$asideNavList.add($middleList).on("click",".edit",function(){return $(this).parent().siblings(".dropdown-menu").show(),!1});var t=this;$asideNavList.add($middleList).on("click",".dropdown-menu .rename",function(){$self=$(this),$self.closest($asideNavList).length?$middleList.find(".dropdown-menu").hide():$asideNavList.find(".dropdown-menu").hide();var e=$(this).parent().parent(),i=e.find(".editable"),n=e.find(".non-editable");setTimeout(function(){i.find("input").select(),i.find("input").focus()},100),n.hide(),i.show(),i.find("input").on("blur",function(){n.html($(this).val()).show(),i.hide();var e=$self.attr("data-noteid"),o=$(this).val();t.renameNote(e,o)})}).on("click",".dropdown-menu .del",function(){var e=null;$(this).parent().hide(),$notyMask.show(),$notyBox.slideDown(),e=$(this).attr("data-noteid"),t.useNotyBox(t.deleteNote,e)}).on("click",".dropdown-menu .moveto",function(){t.tobeMovedNoteId=$(this).attr("data-noteid");var e=$(this).attr("data-notetitle"),i=$(this).attr("data-isfile");$(this).parent().hide(),$moveMask.show(),1==i?$moveBox.find(".file-info .iconfont").addClass("icon-file"):$moveBox.find(".file-info .iconfont").addClass("icon-folder"),$moveBox.find(".file-txt").html(e),$moveBox.slideDown()})},initAsideMiddleEvent:function(){this.initSwitchListItemEvent(),this.initAddNoteEvent(),this.initDropdownEvent()},initAddNoteEvent:function(){var t=this;$(".new,.newfolder,.newfile").click(function(){var e=$(this);if($(this).attr("disabled",!0),e.get(0)==$(".new").get(0)||e.get(0)==$(".newfolder").get(0))var i={notes:[{title:"New Folder"}]};else var i={notes:[{title:"New File",isfile:!0}]};if(e.get(0)==$(".new").get(0)){var n=template("tpl-folder-list",i);$asideNavList.append(n);var o=$asideNavList.children().last()}else if(e.get(0)==$(".newfolder").get(0)){var n=template("tpl-folder-list",i),d=$asideNavList.find("[data-list-item='"+t.crtFolderId+"']").find(".sub-nav-list").first();d.append(n);var o=d.children().last()}else{var n=template("tpl-file-list",i);$middleList.append(n);var o=$middleList.children().last()}o.find(".non-editable").hide().end().find(".editable").show().find("input").select(),o.find(".item .a-wrapper").addClass("active"),o.siblings().find(".item .a-wrapper").removeClass("active"),o.find("input").on("blur",function(){if(o.find(".non-editable").html($(this).val()).show().end().find(".editable").hide(),e.get(0)==$(".new").get(0)){var i={title:$(this).val()};t.addRootFolder(i)}else if(e.get(0)==$(".newfolder").get(0)){var i={title:$(this).val(),parentId:t.crtFolderId};t.addFolder(i)}else{var i={title:$(this).val(),parentId:t.crtFolderId};t.addFile(i)}})})},fetchFile:function(t){var e=this;$.hkAjax("get","/notes/getfile",{fileId:e.crtFileId},function(t){console.log("res file:",t),e.crtFileObj=t,e.renderMain()})},useNotyBox:function(t,e){var i=this,n=$notyBox.find(".noty-btns");n.find(".cancel").click(function(){$notyMask.hide(),$notyBox.slideUp(),$(this).off("click")}),n.find(".confirm").click(function(){$notyMask.hide(),$notyBox.slideUp(),i.deleteNote(e),$(this).off("click")})},addRootFolder:function(t){var e=this;$.hkAjax("post","/notes/addrootfolder",t,function(t){e.fetchnotes()},"text")},addFile:function(t){var e=this;$.hkAjax("post","/notes/addfile",t,function(t){e.fetchnotes()},"text")},addFolder:function(t){var e=this;$.hkAjax("post","/notes/addfolder",t,function(t){e.fetchnotes()},"text")},deleteNote:function(t){var e=this;$.hkAjax("post","/notes/delete",{noteId:t},function(t){e.fetchnotes()},"text")},renameNote:function(t,e){$.hkAjax("post","/notes/rename",{noteId:t,title:e},function(t){console.log("rename res:",t)},"text")},updateFile:function(t){var e={noteId:t.noteId,title:t.title,content:t.content};$.hkAjax("post","/notes/updatefile",e,function(t){$saveTip.slideDown(),setTimeout(function(){$saveTip.slideUp()},800)},"text")},fetchnotes:function(t){var e=this;$.hkAjax("get","/notes/",{},function(i){$.disHkLoading(),t&&(e.initBodyEvent(),e.initAsideMiddleEvent(),e.initMoveBoxEvent()),e.renderAside(i)})},fetchFileList:function(t){var e=this;$.hkAjax("get","/notes/files",{folderId:e.crtFolderId},function(t){e.renderMiddle(t)})}},Object.defineProperty(Edit.prototype,"constructor",{enumerable:!1,value:Edit}),$(function(){new Edit});